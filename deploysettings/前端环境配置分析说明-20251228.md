# 前端环境配置分析说明

## 一、前端环境变量配置总览

### 📁 配置文件位置
- **开发环境**: `apps/public-web/src/features/mvp/phase1/web/.env.development`
- **生产环境**: `apps/public-web/src/features/mvp/phase1/web/.env.production`

### ⚙️ Docker Compose 构建参数
```yaml
args:
  BASE_PATH: /finestem/        # 前端基础路径 ⭐
  API_BASE_URL: /finestem/api  # API 基础地址 ⭐
```

---

## 二、前端环境变量详解

### 🟢 开发环境（`.env.development`）
| 变量名 | 值 | 说明 | 使用场景 |
|--------|-----|------|----------|
| `VITE_API_BASE_URL` | (空字符串) | 使用 Vite 开发代理 | 本地开发时走 Vite 代理 |
| `VITE_APP_NAME` | `FineSTEM` | 应用名称 | 页面标题显示 |
| `VITE_ENV` | `development` | 环境标识 | 开发环境标识 |
| `VITE_DEBUG` | `true` | 调试模式开启 | 启用调试功能 |
| `VITE_APP_VERSION` | `1.0.0` | 应用版本 | 版本信息显示 |

### 🔴 生产环境（`.env.production`）
| 变量名 | 值 | 说明 | 使用场景 |
|--------|-----|------|----------|
| `VITE_API_BASE_URL` | `/finestem/api` | API 地址 ⭐ | 通过 nginx 代理到后端 |
| `VITE_APP_NAME` | `FineSTEM` | 应用名称 | 页面标题显示 |
| `VITE_ENV` | `production` | 环境标识 | 生产环境标识 |
| `VITE_DEBUG` | `false` | 调试模式关闭 | 禁用调试功能 |
| `VITE_APP_VERSION` | `1.0.0` | 应用版本 | 版本信息显示 |

---

## 三、关键配置说明

### 🔗 API 地址配置机制

**开发环境**：
- `VITE_API_BASE_URL` 为空字符串
- 使用 Vite 开发服务器的代理功能
- 请求自动转发到后端服务

**生产环境**：
- `VITE_API_BASE_URL` 设置为 `/finestem/api`
- 通过 nginx 反向代理到后端服务
- 必须与 nginx 配置的 `location /finestem/api/` 匹配

### 🏗️ 构建时参数注入
- `BASE_PATH: /finestem/` - 前端应用的基础路径
- `API_BASE_URL: /finestem/api` - API 服务的基础地址
- 这些参数在 Docker 构建阶段注入到前端应用

---

## 四、路径配置一致性验证

### ✅ 配置一致性检查

| 配置项 | 期望值 | 实际值 | 状态 |
|--------|--------|--------|------|
| **BASE_PATH** | `/finestem/` | `/finestem/` | ✅ 一致 |
| **API_BASE_URL** | `/finestem/api` | `/finestem/api` | ✅ 一致 |
| **VITE_API_BASE_URL** | `/finestem/api` | `/finestem/api` | ✅ 一致 |

### 🌐 nginx 代理配置验证
前端生产环境的 API 请求路径必须与 nginx 配置匹配：
- 前端请求：`/finestem/api/chat`
- nginx 配置：`location /finestem/api/`
- 后端服务：`/finestem/api` (ROOT_PATH)

---

## 五、环境切换机制

### 🔄 开发 ↔ 生产环境切换

**开发环境**：
- 使用 `.env.development` 配置文件
- Vite 开发服务器代理 API 请求
- 调试功能启用

**生产环境**：
- 使用 `.env.production` 配置文件
- nginx 反向代理 API 请求
- 调试功能禁用

### ⚠️ 重要注意事项
1. **路径一致性**：确保所有路径配置保持一致
2. **代理配置**：开发和生产环境的代理机制不同
3. **构建参数**：Docker 构建参数会覆盖部分环境变量

---

## 六、问题排查指南

### 🚨 常见问题

1. **API 请求 404 错误**
   - 检查 `VITE_API_BASE_URL` 配置
   - 验证 nginx 代理配置
   - 确认后端服务 ROOT_PATH 设置

2. **路径访问异常**
   - 检查 `BASE_PATH` 构建参数
   - 验证静态资源路径配置
   - 确认 nginx 路由规则

3. **环境变量不生效**
   - 确认配置文件路径正确
   - 检查 Dockerfile 环境变量处理
   - 验证构建参数注入

### 🔧 调试建议
- 开发环境：使用浏览器开发者工具查看网络请求
- 生产环境：检查 nginx 访问日志和错误日志
- 环境切换：确认配置文件已正确切换
