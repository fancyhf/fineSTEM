toolName: view_folder
            
status: success
          
G:\mediaProjects\fineSTEM\src
          

        
            
toolName: view_files
            
status: success
          
            
filePath: G:\mediaProjects\fineSTEM\apps\web\src\pages\TrackA\index.tsx
          

        
            
toolName: view_files
            
status: success
          
            
filePath: G:\mediaProjects\fineSTEM\apps\web\src\components\TrackA\SimulationCanvas.tsx
          

        
            
toolName: view_files
            
status: success
          
            
filePath: G:\mediaProjects\fineSTEM\apps\backend\routers\track_a.py
          
# 现有代码与架构分析报告

## 1. 现状盘点：当前代码实现了什么？

经过对 `apps/web` 和 `apps/backend` 的深度扫描，目前的代码库实质上是一个 **"Track A：双摆混沌模拟" (Double Pendulum Chaos Simulation)** 的垂直 MVP 原型。

### 1.1 前端 (`apps/web`)
*   **核心功能**：
    *   **Track A 模拟器**：基于 `matter-js` 物理引擎实现的双摆模拟，支持实时渲染与交互。
    *   **配置管理**：支持调整摆长、质量、重力、摩擦力等参数，并提供“高能混沌”、“低能摆动”等预设。
    *   **媒体录制**：通过 `useCanvasRecorder` Hook 实现了 Canvas 画面的录制与下载（初步的媒体生产能力）。
    *   **Track E 占位**：存在 `TrackE` 页面但尚为空白。
*   **技术栈**：React 18 + TypeScript + Vite + Tailwind CSS + Lucide React (图标) + Matter.js (物理)。

### 1.2 后端 (`apps/backend`)
*   **核心功能**：
    *   **配置持久化**：提供 `/track-a/config/export` 接口，将前端的模拟参数保存为本地 JSON 文件。
    *   **数据回溯**：提供 `/track-a/config/latest` 接口获取最新配置。
*   **技术栈**：FastAPI (Python) + Pydantic (Schema 定义)。

### 1.3 结论
**当前代码是一个典型的“单体应用”架构，专注于解决“单一 PBL 项目（Track A）”的交互与演示问题，而非整个 fineSTEM 平台的通用架构。**

---

## 2. 原始需求 vs. 现有支撑能力

我们来对比 fineSTEM 的宏大愿景与当前 `src` (即 `apps` 下的代码) 的支撑能力：

| 核心需求维度 | 原始需求描述 | 当前代码支撑情况 | 缺口 (Gap) |
| :--- | :--- | :--- | :--- |
| **PBL 体系** | 支持多种 PBL 项目的定义、模板化、评估与交付。 | **仅实现了 1 个具体的 PBL 实例** (Track A)。 | 缺少通用的 PBL 数据模型（课程、任务、量表）和管理后台。 |
| **媒体运营** | 完整的素材管理、母版工程、多端发布流水线。 | **仅有前端录屏功能**。 | 缺少素材库、元数据管理、版权控制和自动化处理管线。 |
| **独立应用** | 分离的“公众学习端”与“运营管理端”。 | **混合在一起**。`apps/web` 既是播放器也是编辑器，且未做权限分离。 | 需要将面向公众的 Viewer 和面向运营的 Manager 拆分。 |
| **MCP/Agent** | 智能体协作驱动开发与运营。 | **完全缺失**。无 Agent 接入点或编排逻辑。 | 代码中没有任何 Agent 接口或 MCP 资源映射。 |
| **技术中立** | 架构不绑定特定框架。 | **强绑定**。深度依赖 React 和 FastAPI。 | 核心业务逻辑（如物理参数校验）耦合在 UI/API 层，难以复用。 |

---

## 3. 架构风险评估

如果继续沿用当前的 `apps` 结构进行扩展，将面临以下风险：

1.  **“烟囱式”开发**：每新增一个 PBL 项目（如 Track B），都需要拷贝一份类似的代码，导致维护成本指数级上升。
2.  **业务逻辑碎片化**：PBL 的核心规则散落在前端组件 (`SimulationCanvas`) 和后端路由中，无法形成统一的领域模型。
3.  **Agent 难以介入**：由于缺乏统一的服务层 (`Service Layer`) 和接口层 (`Interface Layer`)，Agent 无法通过标准指令调用系统能力（如“生成 Track A 的演示视频”）。

## 4. 改进建议

**不应直接删除现有代码，而应将其作为“第一阶段 MVP”妥善安置，并在此基础上构建新的分层架构。**

1.  **保留 MVP**：将当前的 `apps/web` 和 `apps/backend` 视为 `apps/public-web/src/features/mvp/phase1` 的具体实现，保留其作为演示和验证的价值。
2.  **抽离通用层**：
    *   将 `SimulationConfig` 等数据定义抽离到顶层 `src/domain/pbl/track-a`。
    *   将 `useCanvasRecorder` 的逻辑抽象为通用的 `MediaRecorderAdapter`。
3.  **重构 Apps**：
    *   **Public Web**：专注于 PBL 项目的“播放”与“交互”。
    *   **Ops Portal**：专注于 PBL 项目的“配置”与“媒体资产管理”。

**一句话总结：当前代码是 fineSTEM 的一颗“种子”（具体的 PBL 案例），但缺乏支撑其长成森林的“土壤”（通用架构与平台能力）。我们需要在保留种子的同时，更换土壤。**